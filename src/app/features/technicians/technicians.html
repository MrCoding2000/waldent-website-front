@if (vm$ | async; as vm) {
<div class="technicians-page w-full bg-white">
  @if (fullscreenImageUrl; as imgUrl) {
    <div
      class="fixed inset-0 z-[1000] bg-black/70 backdrop-blur-sm flex items-center justify-center p-4"
      role="dialog"
      aria-modal="true"
      (click)="closeFullscreen()"
    >
      <div class="relative max-w-[95vw] max-h-[90vh]" (click)="$event.stopPropagation()">
        <button
          type="button"
          class="absolute -top-3 -left-3 w-10 h-10 rounded-[12px] bg-white text-gray-850 shadow-sm flex items-center justify-center"
          (click)="closeFullscreen()"
          aria-label="close"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <img
          [src]="imgUrl"
          [alt]="vm.technician.nameFa"
          class="block max-w-[95vw] max-h-[90vh] object-contain rounded-[12px] bg-white"
        />
      </div>
    </div>
  }

  <!-- Top breadcrumbs row (Desktop) -->
  <section class="hidden lg:block">
    <div class="max-w-[1220px] mx-auto px-6 lg:px-16 pt-6">
      <div class="flex items-center justify-between text-gray-850 ">
        <div class="text-[12px] font-light leading-[18px] text-gray-850">
          {{ vm.breadcrumb.right }}
        </div>

        <button type="button" class="inline-flex items-center gap-2 bg-transparent border-0 p-0 cursor-pointer text-[12px] font-medium leading-[18px] text-gray-850 [direction:rtl]" (click)="onReportClick()">
          <img src="/assets/images/info.svg" alt="">
          <span>{{ vm.breadcrumb.left }}</span>
        </button>
      </div>
    </div>
  </section>

  <!-- Desktop layout -->
  <section class="hidden lg:block">
    <div class="max-w-[1220px] mx-auto px-6 lg:px-16 pt-11 pb-10">
      <div class="grid grid-cols-[1fr_2fr_1fr] gap-8 items-start">

        <!-- Right: Avatar card + side actions -->
        <aside class="flex flex-row-reverse items-start gap-4 justify-self-end w-full max-w-[260px]">
          <div class="w-[200px] h-[200px] bg-gray-150 rounded-[8px] flex items-center justify-center relative overflow-hidden">
            <img [src]="vm.technician.avatarUrl" alt="" class="max-w-[95px] object-contain opacity-90 rounded-[8px]" />
            <button type="button" class="absolute top-2 left-2 w-12 h-12 bg-white rounded-[8px] shadow-sm flex items-center justify-center" (click)="onFullscreenClick(vm.technician.avatarUrl)">
              <img src="assets/images/square.svg" alt="">

            </button>
          </div>

          <div class="pt-2 flex flex-col gap-4">
            <button type="button" class="w-10 h-10 bg-transparent border-0 p-0 cursor-pointer text-gray-850" (click)="onFavoriteClick()" aria-label="favorite">
              <img src="assets/images/heart.svg" alt="">

            </button>
            <button type="button" class="w-10 h-10 bg-transparent border-0 p-0 cursor-pointer text-gray-850" (click)="onShareClick()" aria-label="share">
              <img src="assets/images/back.svg" alt="">

            </button>
          </div>
        </aside>

        <!-- Middle: Title + stats + specialties + brands -->
        <main class="min-w-0">
          <div class="text-center">
            <h1 class="text-gray-850 font-semibold text-[20px] leading-[28px]">{{ vm.technician.nameFa }}</h1>
            <p class="mt-1 text-gray-850/60 text-[12px] leading-[18px]">{{ vm.technician.nameEn }}</p>
          </div>

          <!-- Stats row -->
          <div class="mt-5 flex items-center justify-center gap-6 text-gray-850">
            <div class="inline-flex items-center gap-2">
              <span class="text-[12px] leading-5">{{ vm.stats.questions }} پرسش</span>
              <span class="text-gray-200">|</span>
            </div>
            <div class="inline-flex items-center gap-2">
              <span class="text-[12px] leading-5">{{ vm.stats.reviews }} دیدگاه</span>
              <span class="text-gray-200">|</span>
            </div>
            <div class="inline-flex items-center gap-2">
              <span class="text-[12px] leading-5">{{ vm.stats.projects }} پروژه موفق</span>
              <span class="text-gray-200">|</span>
            </div>
            <div class="inline-flex items-center gap-2">
              <span class="text-[12px] leading-5">{{ vm.stats.rating }}</span>
              <span class="text-[12px] leading-5 text-gray-850/70">({{ vm.stats.votes }} رأی)</span>
              <span class="text-[#F5A300] text-[14px] leading-4">★</span>
            </div>
          </div>

          <!-- Primary specialty -->
          <div class="mt-8">
            <h2 class="text-gray-850 font-semibold text-[14px] leading-6 text-center">{{ vm.primarySpecialty.title }}</h2>
            <div class="mt-3 bg-gray-150 rounded-[12px] px-6 py-4">
              <div class="text-center">
                <div class="text-gray-850 font-medium text-[13px] leading-6">{{ vm.primarySpecialty.name }}</div>
                <div class="mt-2 text-gray-850/70 text-[12px] leading-6">{{ vm.primarySpecialty.desc }}</div>
              </div>
            </div>
          </div>

          <!-- Other specialties -->
          <div class="mt-7">
            <h3 class="text-gray-850 font-semibold text-[14px] leading-6 text-center">{{ vm.otherSpecialtiesTitle }}</h3>
            <div class="mt-3 grid grid-cols-3 gap-4">
              @for (s of vm.otherSpecialties; track s) {
                <div class="bg-gray-150 rounded-[12px] px-4 py-3 text-center text-gray-850 text-[12px] leading-5">
                  {{ s }}
                </div>
              }
              <button type="button" class="border border-dashed border-gray-200 rounded-[12px] px-4 py-3 text-center text-gray-850 text-[12px] leading-5">
                مشاهده همه تخصص ها
              </button>
            </div>
          </div>

          <!-- Brands -->
          <div class="mt-10">
            <h3 class="text-gray-850 font-semibold text-[14px] leading-6 text-center">{{ vm.brandsTitle }}</h3>
            <div class="mt-5 flex items-center justify-center gap-10">
              @for (b of vm.brands; track b.logoUrl + b.name) {
                <div class="inline-flex items-center gap-2">
                  <img [src]="b.logoUrl" [alt]="b.name" class="h-6 w-auto object-contain" />
                </div>
              }
            </div>
          </div>
        </main>

        <!-- Left: Contact -->
        <aside class="pt-[96px] justify-self-start w-full max-w-[360px]">
          <div class="flex flex-col items-start">
            <div class="mb-4 w-full flex gap-2 text-[10px] leading-5 text-gray-850">
              <span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-gray-150">
                <img src="assets/images/verified.svg" alt="" class="w-4 h-4" />
              </span>
              <span>{{ vm.technician.verifiedText }}</span>
            </div>
            <button
              type="button"
              class="w-full h-12 rounded-[20px] bg-brand text-white font-medium text-sm leading-6"
              (click)="onContactClick()"
            >
              مشاهده اطلاعات تماس
            </button>

          </div>
        </aside>

      </div>
    </div>
  </section>

  <!-- Mobile layout -->
  <section class="lg:hidden">
    <div class="px-4 pt-3 pb-6">
      <!-- Breadcrumbs (mobile) -->
      <div class="flex items-center justify-between text-gray-850">
        <div class="text-[10px] leading-4 text-gray-850/70">{{ vm.breadcrumb.right }}</div>
      </div>

      <!-- Avatar -->
      <div class="mt-3 bg-gray-150 rounded-[10px] h-[260px] w-full flex items-center justify-center relative overflow-hidden">
        <img [src]="vm.technician.avatarUrl" alt="" class="w-full h-full object-contain rounded-[10px]" />
        <button type="button" class="absolute top-3 left-3 w-10 h-10 bg-white rounded-[12px] shadow-sm flex items-center justify-center" (click)="onFullscreenClick(vm.technician.avatarUrl)">
          <img src="assets/images/square.svg" alt="">

        </button>
        <div class="absolute top-3 right-3 flex flex-col gap-3">
          <button type="button" class="w-10 h-10 bg-white rounded-[12px] shadow-sm flex items-center justify-center" (click)="onFavoriteClick()">
            <img src="assets/images/heart.svg" alt="">

          </button>
          <button type="button" class="w-10 h-10 bg-white rounded-[12px] shadow-sm flex items-center justify-center" (click)="onShareClick()">
            <img src="assets/images/back.svg" alt="">

          </button>
        </div>
      </div>

      <!-- Name -->
      <div class="mt-4 text-center">
        <h1 class="text-gray-850 font-semibold text-[18px] leading-7">{{ vm.technician.nameFa }}</h1>
        <div class="text-gray-850/60 text-[11px] leading-4 mt-1">{{ vm.technician.nameEn }}</div>
      </div>

      <!-- Stats pills row -->
      <div class="mt-3 flex items-center justify-center gap-4 text-[12px] leading-5 text-gray-850">
        <div class="inline-flex items-center gap-1">
          <span>{{ vm.stats.projects }}</span><span>پروژه موفق</span>
        </div>
        <span class="text-gray-200">|</span>
        <div class="inline-flex items-center gap-1">
          <span>{{ vm.stats.reviews }}</span><span>دیدگاه</span>
        </div>
        <span class="text-gray-200">|</span>
        <div class="inline-flex items-center gap-1">
          <span>{{ vm.stats.questions }}</span><span>پرسش</span>
        </div>
        <span class="text-gray-200">|</span>
        <div class="inline-flex items-center gap-1">
          <span class="text-[#F5A300]">★</span>
          <span>{{ vm.stats.rating }}</span>
          <span class="text-gray-850/70">({{ vm.stats.votes }} رأی)</span>
        </div>
      </div>

      <!-- Verified row -->
      <div class="mt-3 flex items-center justify-center gap-2 text-[12px] leading-5 text-gray-850">
        <img src="assets/images/verified_user.svg" alt="" class="w-4 h-4" />
        <span>{{ vm.technician.verifiedText }}</span>
      </div>

      <!-- Primary specialty -->
      <div class="mt-5">
        <h2 class="text-gray-850 font-semibold text-[13px] leading-6 text-center">{{ vm.primarySpecialty.title }}</h2>
        <div class="mt-2 bg-gray-150 rounded-[12px] px-4 py-4 text-center">
          <div class="text-gray-850 font-medium text-[12px] leading-6">{{ vm.primarySpecialty.name }}</div>
          <div class="mt-2 text-gray-850/70 text-[12px] leading-6">{{ vm.primarySpecialty.desc }}</div>
        </div>
      </div>

      <!-- Other specialties -->
      <div class="mt-6">
        <h3 class="text-gray-850 font-semibold text-[13px] leading-6 text-center">{{ vm.otherSpecialtiesTitle }}</h3>
        <div class="mt-2 grid grid-cols-2 gap-3">
          @for (s of vm.otherSpecialties; track s) {
            <div class="bg-gray-150 rounded-[12px] px-3 py-3 text-center text-gray-850 text-[12px] leading-5">
              {{ s }}
            </div>
          }
        </div>
      </div>

      <!-- Service locations -->
      <div class="mt-6">
        <h3 class="text-gray-850 font-semibold text-[13px] leading-6 text-center">{{ vm.serviceLocationsTitle }}</h3>
        <div class="mt-3 space-y-3">
          @for (loc of vm.serviceLocations; track loc.province) {
            <div class="bg-white border border-gray-200 rounded-[12px] px-4 py-3">
              <div class="flex items-center justify-between">
                <div class="text-gray-850 font-medium text-[12px] leading-6">{{ loc.province }}</div>
                <div class="text-gray-850/60 text-[11px] leading-5">{{ loc.city }}</div>
              </div>
            </div>
          }
        </div>
      </div>

      <!-- Brands -->
      <div class="mt-6">
        <h3 class="text-gray-850 font-semibold text-[13px] leading-6 text-center">{{ vm.brandsTitle }}</h3>
        <div class="mt-4 flex items-center justify-center gap-6 flex-wrap">
          @for (b of vm.brands; track b.logoUrl + b.name) {
            <img [src]="b.logoUrl" [alt]="b.name" class="h-6 w-auto object-contain" />
          }
        </div>
      </div>

      <!-- CTA buttons -->
      <div class="mt-6 space-y-3">
        <button type="button" class="w-full h-12 rounded-[20px] border border-brand bg-transparent text-brand font-medium text-[14px] leading-6" (click)="onContactClick()">
          تماس با تکنسین
        </button>
        <button type="button" class="w-full h-12 rounded-[20px] border border-brand bg-transparent text-brand font-medium text-[14px] leading-6" (click)="onResumeClick()">
          مشاهده رزومه
        </button>
        <button type="button" class="w-full bg-transparent border-0 text-gray-850/70 text-[12px] leading-6 inline-flex items-center justify-center gap-2" (click)="onReportClick()">
          <span class="inline-flex w-4 h-4 items-center justify-center rounded-[4px] border border-gray-200 text-gray-850">!</span>
          <span>{{ vm.reportTitle }}</span>
        </button>
      </div>

      <!-- Profile card -->
      <div class="mt-6 bg-gray-150 rounded-[14px] p-4">
        <div class="flex items-center justify-between mb-3">
          <div class="text-gray-850 font-semibold text-[13px] leading-6">{{ vm.profileTitle }}</div>
          <span class="text-gray-850/60 text-[12px]">≡</span>
        </div>
        <div class="space-y-3">
          @for (row of vm.profileSpecs; track row.label) {
            <div class="flex items-center justify-between gap-4">
              <div class="text-gray-850/70 text-[12px] leading-6">{{ row.label }}</div>
              @if (row.isLink) {
                <a class="text-gray-850 text-[12px] leading-6 underline decoration-gray-200" [href]="(row.linkPrefix || '') + row.value">{{ row.value }}</a>
              } @else {
                <div class="text-gray-850 text-[12px] leading-6">{{ row.value }}</div>
              }
            </div>
          }
        </div>
      </div>

      <!-- Specialties list -->
      <div class="mt-6">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-gray-850 font-semibold text-[13px] leading-6">{{ vm.specialtiesTitle }}</h3>
          <span class="text-gray-850/60 text-[12px]">≡</span>
        </div>
        <div class="space-y-3">
          @for (sp of vm.specialties; track sp.title) {
            <div class="bg-gray-150 rounded-[14px] p-4">
              <div class="text-gray-850 font-medium text-[13px] leading-6">{{ sp.title }}</div>
              <div class="mt-2 text-gray-850/70 text-[12px] leading-6">{{ sp.desc }}</div>
            </div>
          }
        </div>
      </div>
    </div>
  </section>
</div>
} @else {
  <div class="w-full min-h-[50vh] flex items-center justify-center text-gray-850/70">در حال دریافت اطلاعات...</div>
}
