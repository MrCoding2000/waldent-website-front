<section class="technicians-list-page w-full bg-gray-50 lg:bg-white">
  <app-technicians-breadcrumb
    [activeFilters]="activeFilters"
    (removeFilter)="onRemoveFilter($event)"
    (removeAllFilters)="onRemoveAllFilters()">
  </app-technicians-breadcrumb>

  <!-- Active Filters (Desktop) -->
  <div class="hidden lg:block px-4 lg:px-16">
    <div class="max-w-[1220px] mx-auto">
      <app-active-filters
        [activeFilters]="activeFilters"
        (removeFilter)="onRemoveFilter($event)"
        (removeAllFilters)="onRemoveAllFilters()">
      </app-active-filters>
    </div>
  </div>
  <div class="max-w-[1220px] mx-auto px-4 lg:px-16 py-6">
    <div class="flex flex-col lg:flex-row gap-6">

      <!-- Filter Sidebar (Desktop only) -->
      <aside class="hidden lg:block lg:w-auto lg:flex-shrink-0">
        <app-technician-filter
          #filterComponent
          (filterChange)="onFilterChange($event)"
          (activeFiltersChange)="onActiveFiltersChange($event)">
        </app-technician-filter>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 min-w-0">
        <!-- Top Bar -->
        <div class="hidden lg:flex bg-[#F7F9FB] rounded-[28px] mb-4 items-center justify-between direction-rtl py-2 pl-2 pr-4 h-16">
          <!-- Sort Options (Right) -->
          <div class="flex items-center gap-3">
            <span class="text-gray-850 text-[14px]">ترتیب نمایش:</span>
            <div class="flex items-center gap-2">
              <button
                type="button"
                [ngClass]="{
                  ' bg-[#FFFFFF] text-[#009975] rounded-[20px]': sortBy === 'closest',
                  'text-gray-850': sortBy !== 'closest'
                }"
                class="text-[14px] transition-colors py-2 px-4 h-12"
                (click)="setSortBy('closest')">
                نزدیکترین ها
              </button>
              <button
                type="button"
                [ngClass]="{
                  'bg-[#FFFFFF] text-[#009975] rounded-[20px]': sortBy === 'rating',
                  'text-gray-850': sortBy !== 'rating'
                }"
                class="text-[14px] transition-colors py-2 px-4 h-12"
                (click)="setSortBy('rating')">
                بیشترین امتیاز
              </button>
            </div>
          </div>

          <!-- View Mode Toggles (Left) -->
          <div class="flex items-center gap-2">
            <button
              type="button"
              class="p-2 transition-colors"
              [class.text-[#009975]]="viewMode === 'list'"
              [class.text-gray-850]="viewMode !== 'list'"
              (click)="setViewMode('list')"
              aria-label="List view">
              <img src="assets/images/equal.svg" alt="">

            </button>
            <button
              type="button"
              class="p-2 transition-colors"
              [class.text-[#009975]]="viewMode === 'grid'"
              [class.text-gray-850]="viewMode !== 'grid'"
              (click)="setViewMode('grid')"
              aria-label="Grid view">
              <img class="text-[#009975]" src="assets/images/squre-chart.svg" alt="">
            </button>

          </div>
        </div>

        <!-- Technicians List -->
        @if (viewMode === 'grid') {
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            @for (technician of filteredTechnicians; track technician.id) {
              <div class="bg-white rounded-[12px] p-4 cursor-pointer"
                   [routerLink]="['/technician', technician.id]">
                <!-- Top Section: Heart/Star/Rating | Name | Avatar -->
                <div class="flex items-center justify-between mb-3">
                  <!-- Right: Small Avatar -->
                  <div class="flex-shrink-0">
                    <div class="w-10 h-10 rounded-[16px] bg-[#F7F9FB] flex items-center justify-center">
                      <img src="assets/images/technician.png" alt="{{ technician.name }}" class="w-5 h-5">
                    </div>
                  </div>

                  <!-- Center: Name -->
                  <h3 class="text-gray-850 font-semibold text-[14px] leading-5 flex-1 px-2">{{ technician.name }}</h3>

                  <!-- Left: Heart Icon, Star Icon, Rating -->
                  <div class="flex items-center gap-2 flex-shrink-0">
                    <span class="text-gray-850 text-[12px]">{{ technician.rating }}/5</span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" class="text-gray-850">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" fill="currentColor"/>
                    </svg>
                    <button type="button" class="text-gray-400 hover:text-red-500" (click)="$event.preventDefault(); $event.stopPropagation();">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>

                  </div>

                </div>

                <!-- Middle Section: Briefcase Icon + Specialty -->
                <div class="flex items-center gap-2 mb-3">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" class="text-gray-400 flex-shrink-0">
                    <rect x="2" y="7" width="20" height="14" rx="2" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" stroke="currentColor" stroke-width="1.5"/>
                  </svg>
                  <p class="text-gray-850/70 text-[12px] leading-5 line-clamp-2">{{ technician.specialty }}</p>
                </div>

                <!-- Bottom Section: Location Icon + Province/City -->
                <div class="flex items-center gap-1 text-gray-850/70 text-[12px] bg-gray-150 p-1 rounded-[8px]">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" class="flex-shrink-0">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" stroke="currentColor" stroke-width="1.5"/>
                    <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="1.5"/>
                  </svg>
                  <span>استان: {{ technician.province }} | شهر: {{ technician.city }}</span>
                </div>
              </div>
            }
          </div>
        } @else {
          <div class="space-y-4">
            @for (technician of filteredTechnicians; track technician.id) {
              <div class="bg-white rounded-[12px] p-4 border border-gray-200 cursor-pointer hover:shadow-md transition-shadow"
                   [routerLink]="['/technician', technician.id]">
                <div class="flex items-start justify-between mb-3">
                  <div class="flex items-center gap-3 flex-1">
                    <div class="w-12 h-12 bg-gray-150 rounded-[8px] flex items-center justify-center flex-shrink-0">
                      <span class="text-gray-850 text-lg font-semibold">{{ technician.name.charAt(0) }}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                      <div class="flex items-center gap-2 mb-2">
                        <button type="button" class="text-gray-400 hover:text-red-500">
                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                        <span class="text-[#F5A300] text-[14px]">★</span>
                        <span class="text-gray-850 text-[14px]">{{ technician.rating }}/5</span>
                      </div>
                      <h3 class="text-gray-850 font-semibold text-[16px] leading-6 mb-2">{{ technician.name }}</h3>
                    </div>
                  </div>
                </div>
                <p class="text-gray-850/70 text-[14px] leading-6 mb-3">{{ technician.description }}</p>
                <div class="flex items-center gap-1 text-gray-850/70 text-[12px]">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" stroke="currentColor" stroke-width="1.5"/>
                    <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="1.5"/>
                  </svg>
                  <span>استان: {{ technician.province }} | شهر: {{ technician.city }}</span>
                </div>
              </div>
            }
          </div>
        }
      </main>
    </div>
  </div>
</section>
