<section id="reviews" class="tab-section flex">
  <div class="reviews-header-wrapper">
    <!-- Right Side: Rating and Button -->
    <app-small-comments-points-box [reviewSummary]="reviewSummary"></app-small-comments-points-box>
  </div>
  <!-- Left Side -->
  <div>
    <app-reviews-summary-box [reviewSummary]="reviewSummary"></app-reviews-summary-box>
    <!-- Sort Options TODO: COMPONENTS-->
    <div class="sort-options">
      <div class="sort-buttons">
        <span class="sort-label ml-2">ترتیب نمایش:</span>
        @for (option of reviewSortOptions; track option.id) {
          <button
            class="sort-btn"
            [class.active]="selectedSortOption === option.id"
            (click)="selectedSortOption = option.id">
            {{ option.label }}
          </button>
        }
      </div>
    </div>
    <!--Review List-->
    <div class="reviews-list">
      @for (review of reviews; track review.id) {
        <div class="review-card">

          <!-- Header -->
          <div class="review-header">
            <div class="reviewer-info">
              <div class="user flex items-center">
                <img src="assets/images/user.png" alt="">
                <span class="reviewer-name mx-2">{{ review.userName }}</span>
              </div>

              @if (review.isBuyer) {
                <span class="buyer-badge">خریدار</span>
              }
              <span class="review-date">{{ review.date }}</span>
            </div>
            <div class="flex items-center">
              <svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M9.5 12.2115C9.732 12.2115 9.92458 12.1349 10.0778 11.9817C10.2311 11.8286 10.3077 11.6359 10.3077 11.4038C10.3077 11.1718 10.2311 10.9792 10.0778 10.826C9.92458 10.6728 9.732 10.5963 9.5 10.5963C9.268 10.5963 9.07542 10.6728 8.92225 10.826C8.76892 10.9792 8.69225 11.1718 8.69225 11.4038C8.69225 11.6359 8.76892 11.8286 8.92225 11.9817C9.07542 12.1349 9.268 12.2115 9.5 12.2115ZM9.5 8.73075C9.71283 8.73075 9.891 8.659 10.0345 8.5155C10.1782 8.37183 10.25 8.19358 10.25 7.98075V3.44225C10.25 3.22942 10.1782 3.05125 10.0345 2.90775C9.891 2.76408 9.71283 2.69225 9.5 2.69225C9.28717 2.69225 9.109 2.76408 8.9655 2.90775C8.82183 3.05125 8.75 3.22942 8.75 3.44225V7.98075C8.75 8.19358 8.82183 8.37183 8.9655 8.5155C9.109 8.659 9.28717 8.73075 9.5 8.73075ZM3.5385 15L1.5365 17.0018C1.252 17.2864 0.92475 17.3509 0.55475 17.1952C0.184917 17.0394 0 16.7589 0 16.3538V1.80775C0 1.30258 0.175 0.875 0.525 0.525C0.875 0.175 1.30258 0 1.80775 0H17.1923C17.6974 0 18.125 0.175 18.475 0.525C18.825 0.875 19 1.30258 19 1.80775V13.1923C19 13.6974 18.825 14.125 18.475 14.475C18.125 14.825 17.6974 15 17.1923 15H3.5385ZM2.9 13.5H17.1923C17.2693 13.5 17.3398 13.4679 17.4038 13.4038C17.4679 13.3398 17.5 13.2692 17.5 13.1923V1.80775C17.5 1.73075 17.4679 1.66025 17.4038 1.59625C17.3398 1.53208 17.2693 1.5 17.1923 1.5H1.80775C1.73075 1.5 1.66025 1.53208 1.59625 1.59625C1.53208 1.66025 1.5 1.73075 1.5 1.80775V14.8848L2.9 13.5Z"
                  fill="#555555"/>
              </svg>
              <span class="report mr-2">گزارش دیدگاه</span>
            </div>
          </div>
          <div class="review-body">
            <div class="review-rating flex items-center mt-4">
              <span class="rating-number">{{ review.rating }}/5</span>
              <div class="flex gap-1">
                @for (star of getStars(review.rating); track $index) {
                  <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M6.41084 10.1827L3.16896 12.1377C3.04813 12.2083 2.92708 12.2379 2.80583 12.2267C2.68458 12.2154 2.57486 12.1746 2.47667 12.1042C2.37834 12.0336 2.30243 11.9415 2.24896 11.8277C2.19563 11.714 2.18709 11.5881 2.22334 11.4502L3.08396 7.76917L0.221877 5.29167C0.114932 5.19875 0.0468071 5.09111 0.0175016 4.96875C-0.0119429 4.84639 -0.00423455 4.7275 0.0406266 4.61208C0.0854877 4.49681 0.15014 4.40257 0.234585 4.32937C0.319029 4.25618 0.434446 4.20833 0.580835 4.18583L4.35792 3.85583L5.82438 0.379791C5.87771 0.250486 5.95861 0.15486 6.06709 0.0929159C6.17556 0.0309714 6.29014 0 6.41084 0C6.53153 0 6.64611 0.0309714 6.75459 0.0929159C6.86306 0.15486 6.94396 0.250486 6.99729 0.379791L8.46375 3.85583L12.2408 4.18583C12.3872 4.20833 12.5026 4.25618 12.5871 4.32937C12.6715 4.40257 12.7362 4.49681 12.781 4.61208C12.8259 4.7275 12.8336 4.84639 12.8042 4.96875C12.7749 5.09111 12.7067 5.19875 12.5998 5.29167L9.73771 7.76917L10.5983 11.4502C10.6346 11.5881 10.626 11.714 10.5727 11.8277C10.5192 11.9415 10.4433 12.0336 10.345 12.1042C10.2468 12.1746 10.1371 12.2154 10.0158 12.2267C9.89459 12.2379 9.77354 12.2083 9.65271 12.1377L6.41084 10.1827Z"
                      fill="#F67F09"/>
                  </svg>
                }
              </div>
            </div>
            <!-- Text -->
            <p class="review-text mt-2">{{ review.text }}</p>
          </div>
          <!-- Strengths & Weaknesses -->
          <div class="review-points-wrapper">
            <div class="points-box positive">
              <div class="flex items-center">
                <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M5.38717 7.76417L3.8385 6.21533C3.74617 6.12311 3.63011 6.07589 3.49033 6.07367C3.35067 6.07156 3.2325 6.11878 3.13583 6.21533C3.03928 6.312 2.991 6.42911 2.991 6.56667C2.991 6.70422 3.03928 6.82133 3.13583 6.918L4.96533 8.7475C5.08589 8.86794 5.2265 8.92817 5.38717 8.92817C5.54783 8.92817 5.68844 8.86794 5.809 8.7475L9.518 5.0385C9.61022 4.94617 9.65745 4.83011 9.65967 4.69033C9.66178 4.55067 9.61456 4.4325 9.518 4.33583C9.42133 4.23928 9.30422 4.191 9.16667 4.191C9.02911 4.191 8.912 4.23928 8.81533 4.33583L5.38717 7.76417ZM6.3345 12.6667C5.4585 12.6667 4.63511 12.5004 3.86433 12.168C3.09356 11.8356 2.42311 11.3844 1.853 10.8145C1.28289 10.2446 0.8315 9.57444 0.498833 8.804C0.166278 8.03356 0 7.21039 0 6.3345C0 5.4585 0.166222 4.63511 0.498667 3.86433C0.831111 3.09356 1.28228 2.42311 1.85217 1.853C2.42206 1.28289 3.09222 0.8315 3.86267 0.498833C4.63311 0.166278 5.45628 0 6.33217 0C7.20817 0 8.03156 0.166222 8.80233 0.498666C9.57311 0.831111 10.2436 1.28228 10.8137 1.85217C11.3838 2.42206 11.8352 3.09222 12.1678 3.86267C12.5004 4.63311 12.6667 5.45628 12.6667 6.33217C12.6667 7.20817 12.5004 8.03156 12.168 8.80233C11.8356 9.57311 11.3844 10.2436 10.8145 10.8137C10.2446 11.3838 9.57444 11.8352 8.804 12.1678C8.03356 12.5004 7.21039 12.6667 6.3345 12.6667Z"
                    fill="#009975"/>
                </svg>
                <strong class="title mx-1">نقاط قوت</strong>
              </div>
              <ul class="flex gap-1">
                @for (strength of review.strengths; track strength; let last = $last) {
                  <li>
                    {{ strength }}
                    <!--                          TODO: pipe-->
                    @if (!last) {
                      <span>،</span>
                    }
                  </li>
                }
              </ul>
            </div>

            @if (review.weaknesses.length) {
              <div class="points-box negative">
                <div class="flex items-center">
                  <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M6.33333 7.03583L8.382 9.08467C8.47433 9.17689 8.59039 9.22411 8.73017 9.22633C8.86983 9.22844 8.988 9.18122 9.08467 9.08467C9.18122 8.988 9.2295 8.87089 9.2295 8.73333C9.2295 8.59578 9.18122 8.47867 9.08467 8.382L7.03583 6.33333L9.08467 4.28467C9.17689 4.19233 9.22411 4.07628 9.22633 3.9365C9.22845 3.79683 9.18122 3.67867 9.08467 3.582C8.988 3.48544 8.87089 3.43717 8.73333 3.43717C8.59578 3.43717 8.47867 3.48544 8.382 3.582L6.33333 5.63083L4.28467 3.582C4.19233 3.48978 4.07628 3.44256 3.9365 3.44033C3.79683 3.43822 3.67867 3.48544 3.582 3.582C3.48544 3.67867 3.43717 3.79578 3.43717 3.93333C3.43717 4.07089 3.48544 4.188 3.582 4.28467L5.63083 6.33333L3.582 8.382C3.48978 8.47433 3.44256 8.59039 3.44033 8.73017C3.43822 8.86983 3.48544 8.988 3.582 9.08467C3.67867 9.18122 3.79578 9.2295 3.93333 9.2295C4.07089 9.2295 4.188 9.18122 4.28467 9.08467L6.33333 7.03583ZM6.3345 12.6667C5.4585 12.6667 4.63511 12.5004 3.86433 12.168C3.09356 11.8356 2.42311 11.3844 1.853 10.8145C1.28289 10.2446 0.8315 9.57444 0.498833 8.804C0.166278 8.03356 0 7.21039 0 6.3345C0 5.4585 0.166222 4.63511 0.498667 3.86433C0.831111 3.09356 1.28228 2.42311 1.85217 1.853C2.42206 1.28289 3.09222 0.8315 3.86267 0.498833C4.63311 0.166278 5.45628 0 6.33217 0C7.20817 0 8.03156 0.166222 8.80233 0.498666C9.57311 0.831111 10.2436 1.28228 10.8137 1.85217C11.3838 2.42206 11.8352 3.09222 12.1678 3.86267C12.5004 4.63311 12.6667 5.45628 12.6667 6.33217C12.6667 7.20817 12.5004 8.03156 12.168 8.80233C11.8356 9.57311 11.3844 10.2436 10.8145 10.8137C10.2446 11.3838 9.57444 11.8352 8.804 12.1678C8.03356 12.5004 7.21039 12.6667 6.3345 12.6667Z"
                      fill="#C20A0D"/>
                  </svg>
                  <strong class="title mx-1">نقاط ضعف</strong>
                </div>
                <ul class="flex gap-1">
                  @for (weakness of review.weaknesses; track weakness; let last = $last) {
                    <li>
                      {{ weakness }}
                      <!--                          TODO: pipe-->
                      @if (!last) {
                        <span>،</span>
                      }
                    </li>
                  }
                </ul>
              </div>
            }

          </div>

          <!-- Footer -->
          <div class="review-footer">
            <div class="seller-info">
              <svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M2.08934 15.8333C1.81716 15.8333 1.58902 15.7385 1.4049 15.5488C1.22078 15.3592 1.12872 15.1241 1.12872 14.8437V9.89583H0.960615C0.65642 9.89583 0.408261 9.77626 0.216138 9.53711C0.0240154 9.29796 -0.0400256 9.0217 0.0240154 8.70833L0.98463 3.76042C1.03266 3.52951 1.14473 3.33984 1.32085 3.19141C1.49696 3.04297 1.69709 2.96875 1.92123 2.96875H14.7454C14.9696 2.96875 15.1697 3.04297 15.3458 3.19141C15.5219 3.33984 15.634 3.52951 15.682 3.76042L16.6427 8.70833C16.7067 9.0217 16.6427 9.29796 16.4505 9.53711C16.2584 9.77626 16.0102 9.89583 15.7061 9.89583H15.5379V14.8437C15.5379 15.1241 15.4459 15.3592 15.2618 15.5488C15.0776 15.7385 14.8495 15.8333 14.5773 15.8333C14.3052 15.8333 14.077 15.7385 13.8929 15.5488C13.7088 15.3592 13.6167 15.1241 13.6167 14.8437V9.89583H9.77426V14.8437C9.77426 15.1241 9.6822 15.3592 9.49808 15.5488C9.31396 15.7385 9.08581 15.8333 8.81364 15.8333H2.08934ZM3.04995 13.8542H7.85303V9.89583H3.04995V13.8542ZM2.08934 1.97917C1.81716 1.97917 1.58902 1.88433 1.4049 1.69466C1.22078 1.50499 1.12872 1.26997 1.12872 0.989583C1.12872 0.709201 1.22078 0.474175 1.4049 0.284505C1.58902 0.0948351 1.81716 0 2.08934 0H14.5773C14.8495 0 15.0776 0.0948351 15.2618 0.284505C15.4459 0.474175 15.5379 0.709201 15.5379 0.989583C15.5379 1.26997 15.4459 1.50499 15.2618 1.69466C15.0776 1.88433 14.8495 1.97917 14.5773 1.97917H2.08934Z"
                  fill="#222222"/>
              </svg>
              <span class="seller-name">{{ review.sellerName }}</span>
            </div>

            <div class="review-actions">
              <button class="helpful flex items-center">
                <span class="mx-1">{{ review.helpfulCount }}</span>
                <svg width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M18.1923 6.13634C18.6679 6.13634 19.0881 6.31876 19.4527 6.68359C19.8176 7.04826 20 7.46842 20 7.94409V9.55934C20 9.66434 19.9865 9.77684 19.9595 9.89684C19.9327 10.0167 19.9026 10.1286 19.8693 10.2326L17.0033 16.9951C16.8601 17.3149 16.6199 17.5851 16.2828 17.8056C15.9456 18.0261 15.5938 18.1363 15.2273 18.1363H4.7115V6.13634L10.5288 0.36909C10.7276 0.170423 10.9578 0.0518402 11.2193 0.0133402C11.4808 -0.0251598 11.7313 0.0196737 11.971 0.14784C12.2108 0.276174 12.3865 0.458256 12.498 0.69409C12.6095 0.929923 12.6333 1.17417 12.5693 1.42684L11.4923 6.13634H18.1923ZM6.2115 6.77484V16.6363H15.2308C15.3013 16.6363 15.3733 16.6171 15.447 16.5786C15.5208 16.5401 15.577 16.476 15.6155 16.3863L18.5 9.63634V7.94409C18.5 7.85426 18.4712 7.78051 18.4135 7.72284C18.3558 7.66517 18.2821 7.63634 18.1923 7.63634H9.59625L10.85 2.15559L6.2115 6.77484ZM1.80775 18.1363C1.31058 18.1363 0.885 17.9593 0.531 17.6053C0.177 17.2513 0 16.8258 0 16.3286V7.94409C0 7.44692 0.177 7.02134 0.531 6.66734C0.885 6.31334 1.31058 6.13634 1.80775 6.13634H4.7115V7.63634H1.80775C1.71792 7.63634 1.64417 7.66517 1.5865 7.72284C1.52883 7.78051 1.5 7.85426 1.5 7.94409V16.3286C1.5 16.4184 1.52883 16.4922 1.5865 16.5498C1.64417 16.6075 1.71792 16.6363 1.80775 16.6363H4.7115V18.1363H1.80775Z"
                    fill="#222222"/>
                </svg>
              </button>
              <button class="not-helpful flex items-center">
                <span class="mx-1">{{ review.notHelpfulCount }}</span>
                <svg width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M1.80775 12C1.33208 12 0.911917 11.8176 0.54725 11.4528C0.182417 11.0881 0 10.6679 0 10.1923V8.577C0 8.472 0.0135 8.3595 0.0405 8.2395C0.0673333 8.11967 0.0974168 8.00775 0.13075 7.90375L2.99675 1.14125C3.13992 0.821417 3.38008 0.55125 3.71725 0.33075C4.05442 0.11025 4.40625 0 4.77275 0H15.2885V12L9.47125 17.7673C9.27242 17.9659 9.04225 18.0845 8.78075 18.123C8.51925 18.1615 8.26867 18.1167 8.029 17.9885C7.78917 17.8602 7.6135 17.6781 7.502 17.4423C7.3905 17.2064 7.36675 16.9622 7.43075 16.7095L8.50775 12H1.80775ZM13.7885 11.3615V1.5H4.76925C4.69875 1.5 4.62667 1.51925 4.553 1.55775C4.47917 1.59625 4.423 1.66033 4.3845 1.75L1.5 8.5V10.1923C1.5 10.2821 1.52883 10.3558 1.5865 10.4135C1.64417 10.4712 1.71792 10.5 1.80775 10.5H10.4038L9.15 15.9808L13.7885 11.3615ZM18.1923 0C18.6894 0 19.115 0.177 19.469 0.531C19.823 0.885 20 1.31058 20 1.80775V10.1923C20 10.6894 19.823 11.115 19.469 11.469C19.115 11.823 18.6894 12 18.1923 12H15.2885V10.5H18.1923C18.2821 10.5 18.3558 10.4712 18.4135 10.4135C18.4712 10.3558 18.5 10.2821 18.5 10.1923V1.80775C18.5 1.71792 18.4712 1.64417 18.4135 1.5865C18.3558 1.52883 18.2821 1.5 18.1923 1.5H15.2885V0H18.1923Z"
                    fill="#222222"/>
                </svg>
              </button>
            </div>
          </div>

        </div>
      }
    </div>
  </div>
</section>
